

// 1. c
#include <stdlib.h>

int main() {
  char flag[] = {0x66, 0x4a, 0x52, 0x30, 0x75, 0x70, 0x50, 0x56, 0x64,
                 0x2c, 0x7e, 0x57, 0x13, 0x20, 0x3a, 0x78, 0x4c, 0x54,
                 0x64, 0x22, 0x78, 0x56, 0x5b, 0x64, 0x2c, 0x7e, 0x57,
                 0x41, 0x64, 0x39, 0x78, 0x44, 0x56, 0x7b};

  char key[] = {0x11, 0x22, 0x33, 0x44, 0x55};

  int flag_len = 34;
  int key_len = 5;
  for (int i = 0; i < flag_len; i++) {
    flag[i] = flag[i] ^ key[i % key_len];
  }

  return 0;
}

// 2
#include <stdlib.h>

int main() {
  char flag[] = {0x32, 0x1e, 0xe5, 0xfc, 0x31, 0x0f, 0x04, 0xa8, 0xed, 0x78,
                 0x05, 0x1c, 0xe1, 0xf7, 0x76, 0x46, 0x15, 0xfa, 0xf6, 0x3d,
                 0x46, 0x1f, 0xfd, 0xeb, 0x63, 0x1f, 0x57, 0xfd, 0xe9, 0x30};

  char key[] = {0x66, 0x77, 0x88, 0x99, 0x11};

  int flag_len = 30;
  int key_len = 5;
  for (int i = 0; i < flag_len; i++) {
    flag[i] = flag[i] ^ key[i % key_len];
  }

  return 0;
}

// 3
#include <stdio.h>
#include <stdlib.h>

int mystrlen(const char *s) {
  if (!s)
    return 0;

  const char *p = (const char *)s; // byte pointer
  int len = 0;

  // Read one 32-bit code unit at a time
  while (*(const int *)p != 0) { // x86 tolerates unaligned reads
    ++len;
    p += 4;
  }
  return len;
}
char local_argv[1000] = {0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41,
                         0x41, 0x00, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x42,
                         0x42, 0x42, 0x42, 0x00, 0x43, 0x43, 0x43, 0x00, 0x43,
                         0x43, 0x43, 0x43, 0x43, 0x43, 0x00, 0x44, 0x44, 0x44,
                         0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x44, 0x00, 0x79,
                         0x63, 0x63, 0x7a, 0x55, 0x6d, 0x60, 0x6c, 0x6d, 0x00};
;

int main() {

  char *arguments[5] = {0};
  char *tmp = (char *)local_argv;
  // printf("%s\n%s", local_argv, tmp);
  for (int i = 0; i < 5; i++) {
    arguments[i] = tmp; // save the start of the string
    // printf("tmp: %s\n", tmp);
    while (*tmp != '\0')
      tmp++; // advance until null terminator
    tmp++;   // move past '\0' to next string
  }

  // arg [0] -> prog name
  int v1 = *(int *)arguments[1];
  int v2 = *(int *)arguments[2];
  int v3 = *(int *)arguments[3];

  char *key = arguments[4];

  // printf("arguments: %X, tmp: %X\n", &arguments, &tmp);
  // printf("v1: %d\n", v1);
  // printf("v2: %d\n", v2);
  // printf("v3: %d\n", v3);
  // printf("Key: %s\n", key);

  char enc_key[] = {0x79, 0x63, 0x63, 0x7a, 0x55, 0x6d, 0x60, 0x6c, 0x6d};
  char enc_key_key[] = {0xa, 0xb, 0xc, 0xd};

  int enc_key_key_len = 4;
  int enc_key_len = 9;
  for (int i = 0; i < enc_key_len; i++) {
    key[i] = key[i] ^ (enc_key_key[i % enc_key_key_len]);
  }

  char nay[] = {0xB1, 0x9e, 0x86, 0xf5, 0xff};
  for (int i = 0; i < 5; i++) {
    nay[i] = nay[i] ^ 0xff;
  }

  for (int i = 0; i < enc_key_len; i++) {
    // printf("%d, %d\n", key[i], enc_key[i]);
    if ((key[i] - enc_key[i]) != 0) {
      // printf("%d, %d\n", key[i], enc_key[i]);
      printf((char *)nay);
      return 0;
    }
  }

  for (int i = 0; i < enc_key_len; i++) {
    key[i] = key[i] ^ (enc_key_key[i % enc_key_key_len]);
  }

  char flag[] = {0x32, 0x3b, 0x2c, 0x20, 0x18, 0x1d, 0x5f, 0x51, 0x51,
                 0x41, 0x5b, 0x5c, 0x41, 0x00, 0x11, 0x09, 0x0d, 0x0b,
                 0x2c, 0x0c, 0x00, 0x19, 0x3a, 0x39, 0x2f, 0x52, 0x56,
                 0x44, 0x5b, 0x59, 0x35, 0x22, 0x66};

  int flag_len = 33;
  for (int i = 0; i < flag_len; i++) {
    flag[i] = flag[i] ^ (key[i % enc_key_len]);
  }

  char yay[] = {0xe2, 0xda, 0xc2, 0x9a, 0x9b, 0xe2, 0xd4, 0xce,
                0x9b, 0xdc, 0xd4, 0xcf, 0x9b, 0xcf, 0xd3, 0xd2,
                0xc8, 0x9b, 0xc8, 0xcf, 0xc9, 0xd2, 0xd5, 0xdc,
                0x81, 0x9b, 0x9e, 0xc8, 0xb1, 0xbb, 0xbb};

  for (int i = 0; i < 31; i++) {
    yay[i] = yay[i] ^ 0xbb;
  }

  printf((char *)yay, flag);

  return 0;
}
